<!DOCTYPE html>
<html lang="en">
    {% include "head.html" %}
<body>
    <script>
        function getSecret() {
            let token = localStorage.getItem('token');
            fetch('/get/user_rights/' + localStorage.getItem('user') + '?'
            + new URLSearchParams({
                token: token
            })
            ).then(rights_response => {
                rights_response.json().then(rights => {
                    fetch('/get/secret?' 
                    + new URLSearchParams({
                        token: token,
                        user_id: rights.user_rights
                    })
                    ).then(response => {
                        if (response.status == 200) {
                            response.json().then(data => {
                                document.getElementById('secret').innerText = data.secret;
                                document.getElementById('message').innerText = data.message;
                            });
                        } else {
                            document.getElementById('secret').innerText = "sorry";
                            document.getElementById('message').innerText = "You don't have the rights to get it";
                        }
                    });
                });
            });
        }
        
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('secret').innerText = "waiting...";
            document.getElementById('message').innerText = "waiting...";
            getSecret();
        }, false);
        </script>
    {% include "header.html" %}
<p id="secret"></p>
<p id="message"></p>
{% include "footer.html" %}
</body>
</html>